<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi PPID | Provinsi Kalimantan Barat</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js for Interactivity (with defer attribute) -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="https://layanan-diskominfo.kalbarprov.go.id/PPIDKALBAR-PERMOHONAN/public/assets/images/cropped-kalbar-200x200.png">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }
        [x-cloak] { display: none !important; }
        .sidebar-link:hover, .sidebar-link.active {
            background-color: #3b82f6; /* blue-500 */
            color: white;
        }
        .stat-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        /* Custom spinner */
        .spinner {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            width: 16px;
            height: 16px;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            color: #2563eb; /* blue-600 */
            border-color: #2563eb;
        }
        .star-rating svg {
            cursor: pointer;
        }
    </style>
</head>

<body x-data="appData()" x-cloak>

    <!-- ===== LOGIN VIEW ===== -->
    <main x-show="currentPage === 'login'" x-transition.opacity>
        <div class="flex items-center justify-center min-h-screen bg-slate-100 p-4">
            <div 
                class="w-full max-w-md p-8 space-y-8 bg-white rounded-2xl shadow-lg"
                x-transition:enter="transition ease-out duration-300"
                x-transition:enter-start="opacity-0 transform scale-95"
                x-transition:enter-end="opacity-100 transform scale-100"
            >
                <div class="text-center">
                    <img src="https://layanan-diskominfo.kalbarprov.go.id/PPIDKALBAR-PERMOHONAN/public/assets/images/cropped-kalbar-200x200.png" alt="Logo Kalbar" class="w-24 h-24 mx-auto mb-4">
                    <h1 class="text-3xl font-bold text-gray-800">Layanan Permohonan Informasi</h1>
                    <p class="mt-2 text-gray-500">Silakan masuk untuk melanjutkan</p>
                </div>
                <div class="space-y-4">
                    <button @click="login('admin')" class="w-full flex items-center justify-center px-4 py-3 font-semibold text-white bg-red-600 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-all duration-300 transform hover:scale-105">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 8a6 6 0 11-12 0 6 6 0 0112 0zM7 8a4 4 0 118 0 4 4 0 01-8 0zM4.93 14.07a8.001 8.001 0 0010.14 0A8.001 8.001 0 004.93 14.07z" clip-rule="evenodd" /></svg>
                        Masuk sebagai Admin (SSO ASN)
                    </button>
                    <button @click="login('asn')" class="w-full flex items-center justify-center px-4 py-3 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-300 transform hover:scale-105">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0115 11a5 5 0 011 9.9M9 11a5 5 0 00-4.93 4.4A5.002 5.002 0 009 20a5.002 5.002 0 004.93-4.4A5 5 0 009 11z" /></svg>
                        Masuk sebagai User (SSO ASN)
                    </button>
                    <button @click="login('non-asn')" class="w-full flex items-center justify-center px-4 py-3 font-semibold text-white bg-gray-600 rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-300 transform hover:scale-105">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg>
                        Masuk sebagai User (SSO Masyarakat)
                    </button>
                </div>
                <div class="mt-8 pt-4 border-t border-gray-200 text-center space-y-3">
                    <p class="text-sm text-gray-500">Atau, lakukan aksi cepat:</p>
                    <div class="flex flex-col sm:flex-row gap-3">
                        <button @click="currentPage = 'tracking'" class="w-full flex items-center justify-center px-4 py-2 text-sm font-semibold text-blue-600 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
                            Lacak Permintaan
                        </button>
                        <button @click="currentPage = 'process'" class="w-full flex items-center justify-center px-4 py-2 text-sm font-semibold text-gray-600 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M3 3a1 1 0 000 2h11a1 1 0 100-2H3zM3 7a1 1 0 000 2h5a1 1 0 000-2H3zM3 11a1 1 0 100 2h4a1 1 0 100-2H3zM13 16a1 1 0 102 0v-5.586l1.293 1.293a1 1 0 001.414-1.414l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 101.414 1.414L13 10.414V16z" /></svg>
                            Lihat Alur Proses
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ===== USER FORM VIEW ===== -->
    <main x-show="currentPage === 'form'" x-transition.opacity>
        <div class="min-h-screen bg-slate-50">
            <header class="bg-white shadow-md sticky top-0 z-10">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex items-center justify-between h-20">
                        <div class="flex items-center">
                            <img class="h-12 w-auto" src="https://layanan-diskominfo.kalbarprov.go.id/PPIDKALBAR-PERMOHONAN/public/assets/images/cropped-kalbar-200x200.png" alt="Logo Kalbar">
                            <div class="ml-4">
                                <h2 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">PEMERINTAH PROVINSI KALIMANTAN BARAT</h2>
                                <h1 class="text-xl font-extrabold text-gray-800">Formulir Permintaan Informasi</h1>
                            </div>
                        </div>
                        <button @click="logout()" class="inline-flex items-center gap-2 text-sm font-medium text-gray-600 hover:text-blue-600 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd" /></svg>
                            Logout
                        </button>
                    </div>
                </div>
            </header>

            <div class="container mx-auto p-4 sm:p-6 lg:p-8">
                <!-- SUCCESS & FEEDBACK SECTION -->
                <div x-show="formSuccess" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 -translate-y-4" x-transition:enter-end="opacity-100 translate-y-0" class="mb-6">
                    <div class="bg-green-100 border-l-4 border-green-500 text-green-800 p-4 rounded-lg shadow-md" role="alert">
                        <div class="flex">
                            <div class="py-1"><svg class="h-6 w-6 text-green-500 mr-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg></div>
                            <div>
                                <p class="font-bold">Berhasil!</p>
                                <p class="text-sm">Permintaan Anda telah berhasil dikirim dengan ID: <span x-text="lastRequestId" class="font-medium"></span></p>
                            </div>
                        </div>
                    </div>
                    
                    <div x-show="!feedbackSubmitted" x-transition class="mt-6 bg-white p-6 rounded-2xl shadow-lg">
                        <h3 class="text-lg font-semibold text-gray-800 text-center">Beri Penilaian Layanan Kami</h3>
                        <div class="flex justify-center my-4 star-rating">
                            <template x-for="star in [1, 2, 3, 4, 5]">
                                <svg @click="userFeedback.rating = star" class="w-8 h-8 transition-colors" :class="star <= userFeedback.rating ? 'text-yellow-400' : 'text-gray-300'" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                            </template>
                        </div>
                        <textarea x-model="userFeedback.comment" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" rows="3" placeholder="Bagikan masukan Anda..."></textarea>
                        <button @click="submitFeedback()" class="mt-4 w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors">Kirim Penilaian</button>
                    </div>

                    <div x-show="feedbackSubmitted" x-transition class="mt-6 bg-white p-6 rounded-2xl shadow-lg text-center">
                        <p class="text-green-600 font-semibold">Terima kasih atas penilaian Anda!</p>
                    </div>
                </div>

                <form @submit.prevent="submitRequest" class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg space-y-8">
                    <!-- Section 1 -->
                    <div class="border-b border-gray-200 pb-8">
                        <h2 class="text-lg font-semibold leading-7 text-gray-900">Informasi Pemohon</h2>
                        <p class="mt-1 text-sm leading-6 text-gray-600">Data Anda (Nama, Email, Whatsapp) telah terisi otomatis melalui sistem SSO.</p>

                        <div class="mt-6 grid grid-cols-1 gap-x-6 gap-y-6 sm:grid-cols-6">
                            <div class="sm:col-span-3">
                                <label for="opd_tujuan" class="block text-sm font-medium leading-6 text-gray-900">OPD Tujuan <span class="text-red-500">*</span></label>
                                <div class="mt-2">
                                    <select x-model="newRequest.opd" id="opd_tujuan" required class="block w-full rounded-md border-0 py-2.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6">
                                        <option value="">:: Pilih OPD ::</option>
                                        <optgroup label="Pemerintah Prov. Kalbar">
                                            <option>Badan Kepegawaian Daerah Prov. Kalbar</option>
                                            <option>Dinas Komunikasi Dan Informatika Prov. Kalbar</option>
                                            <option>Dinas Kesehatan Prov. Kalbar</option>
                                            <option>Badan Perencanaan Pembangunan Daerah Prov. Kalbar</option>
                                        </optgroup>
                                        <optgroup label="Pemerintah Kab/Kota">
                                            <option>Pemerintah Kota Pontianak</option>
                                            <option>Pemerintah Kota Singkawang</option>
                                        </optgroup>
                                    </select>
                                </div>
                            </div>

                            <div class="sm:col-span-3">
                                <label for="jenis_pemohon" class="block text-sm font-medium leading-6 text-gray-900">Jenis Pemohon <span class="text-red-500">*</span></label>
                                <div class="mt-2">
                                    <select x-model="newRequest.type" id="jenis_pemohon" required class="block w-full rounded-md border-0 py-2.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6">
                                        <option value="">:: Pilih Jenis ::</option>
                                        <template x-for="option in applicantTypes" :key="option.value">
                                            <option :value="option.value" x-text="option.label"></option>
                                        </template>
                                    </select>
                                </div>
                            </div>

                             <div class="sm:col-span-3">
                                <label for="noktp" class="block text-sm font-medium leading-6 text-gray-900">No. Identitas (KTP) <span class="text-red-500">*</span></label>
                                <div class="mt-2">
                                    <input type="text" x-model="newRequest.nik" id="noktp" required class="block w-full rounded-md border-0 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6" placeholder="Masukkan 16 digit NIK">
                                </div>
                            </div>
                            
                            <div class="col-span-full">
                                <label for="alamat" class="block text-sm font-medium leading-6 text-gray-900">Alamat Lengkap <span class="text-red-500">*</span></label>
                                <div class="mt-2">
                                    <textarea x-model="newRequest.address" id="alamat" rows="3" required class="block w-full rounded-md border-0 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6" placeholder="Sesuai KTP"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section 2 -->
                    <div class="border-b border-gray-200 pb-8">
                        <h2 class="text-lg font-semibold leading-7 text-gray-900">Rincian Permintaan Informasi</h2>
                        <p class="mt-1 text-sm leading-6 text-gray-600">Jelaskan informasi yang Anda butuhkan secara rinci.</p>
                        <div class="mt-6 grid grid-cols-1 gap-x-6 gap-y-6">
                            <div class="col-span-full">
                                <label for="informasi_diminta" class="block text-sm font-medium leading-6 text-gray-900">Informasi yang Diminta <span class="text-red-500">*</span></label>
                                <div class="mt-2">
                                    <textarea x-model="newRequest.requestText" id="informasi_diminta" rows="4" required class="block w-full rounded-md border-0 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6"></textarea>
                                </div>
                            </div>

                            <div class="col-span-full">
                                <label for="alasan" class="block text-sm font-medium leading-6 text-gray-900">Alasan Permintaan Informasi <span class="text-red-500">*</span></label>
                                <div class="mt-2">
                                    <textarea x-model="newRequest.reasonText" id="alasan" rows="4" required class="block w-full rounded-md border-0 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 3 - File Uploads -->
                    <div>
                         <h2 class="text-lg font-semibold leading-7 text-gray-900">Lampiran Dokumen</h2>
                         <p class="mt-1 text-sm leading-6 text-gray-600">Unggah dokumen yang diperlukan dalam format PDF atau JPG (Maks 2MB).</p>

                         <div class="mt-6 grid grid-cols-1 gap-y-8 sm:grid-cols-2 gap-x-6">
                            <!-- KTP Upload -->
                            <div>
                                <label class="block text-sm font-medium leading-6 text-gray-900">Scan Identitas (KTP) <span class="text-red-500">*</span></label>
                                <div @dragover.prevent @drop.prevent="e => handleFileDrop(e, 'ktp-upload')" class="mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 px-6 py-10 transition-colors" :class="{'bg-blue-50 border-blue-400': isDraggingKTP}">
                                    <div class="text-center">
                                         <svg class="mx-auto h-12 w-12 text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" /></svg>
                                        <div class="mt-4 flex text-sm leading-6 text-gray-600">
                                            <label for="ktp-upload" class="relative cursor-pointer rounded-md bg-white font-semibold text-blue-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-blue-600 focus-within:ring-offset-2 hover:text-blue-500">
                                                <span>Unggah file</span>
                                                <input id="ktp-upload" name="ktp-upload" type="file" class="sr-only" @change="e => files.ktp = e.target.files[0]">
                                            </label>
                                            <p class="pl-1">atau seret dan lepas</p>
                                        </div>
                                        <p class="text-xs leading-5 text-gray-600">JPG, PNG, PDF hingga 2MB</p>
                                        <p x-show="files.ktp" x-text="files.ktp?.name" class="text-sm text-green-600 mt-2" x-transition></p>
                                    </div>
                                </div>
                            </div>
                             <!-- Supporting Doc Upload -->
                            <div x-show="newRequest.type && newRequest.type !== 'perorangan'" x-transition>
                                <label class="block text-sm font-medium leading-6 text-gray-900">
                                    <span x-text="supportingDocLabel"></span>
                                    <span class="text-red-500">*</span>
                                </label>
                                <div @dragover.prevent @drop.prevent="e => handleFileDrop(e, 'supporting-doc-upload')" class="mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 px-6 py-10 transition-colors" :class="{'bg-blue-50 border-blue-400': isDraggingDoc}">
                                    <div class="text-center">
                                        <svg class="mx-auto h-12 w-12 text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
                                        <div class="mt-4 flex text-sm leading-6 text-gray-600">
                                            <label for="supporting-doc-upload" class="relative cursor-pointer rounded-md bg-white font-semibold text-blue-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-blue-600 focus-within:ring-offset-2 hover:text-blue-500">
                                                <span>Unggah file</span>
                                                <input id="supporting-doc-upload" name="supporting-doc-upload" type="file" class="sr-only" @change="e => files.supportingDoc = e.target.files[0]">
                                            </label>
                                            <p class="pl-1">atau seret dan lepas</p>
                                        </div>
                                        <p class="text-xs leading-5 text-gray-600">PDF hingga 2MB</p>
                                        <p x-show="files.supportingDoc" x-text="files.supportingDoc?.name" class="text-sm text-green-600 mt-2" x-transition></p>
                                    </div>
                                </div>
                            </div>
                         </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="mt-10 flex items-center justify-end gap-x-6">
                        <button @click="logout()" type="button" class="text-sm font-semibold leading-6 text-gray-900">Batal</button>
                        <button type="submit" :disabled="isSubmitting" class="flex items-center justify-center rounded-md bg-blue-600 px-6 py-3 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600 disabled:bg-blue-300 disabled:cursor-not-allowed transition-all duration-300">
                            <div x-show="isSubmitting" class="spinner mr-2"></div>
                            <span x-text="isSubmitting ? 'Mengirim...' : 'Kirim Permintaan'"></span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- ===== ADMIN DASHBOARD VIEW ===== -->
    <main x-show="currentPage === 'dashboard'" x-transition.opacity>
        <div class="flex h-screen bg-gray-100">
            <!-- Sidebar -->
            <aside class="w-64 flex-shrink-0 bg-gray-800 text-white flex flex-col">
                <div class="h-20 flex items-center justify-center bg-gray-900 flex-shrink-0">
                    <div class="flex items-center space-x-3">
                        <img src="https://layanan-diskominfo.kalbarprov.go.id/PPIDKALBAR-PERMOHONAN/public/assets/images/cropped-kalbar-200x200.png" alt="Logo" class="h-10 w-10 rounded-full">
                        <span class="text-lg font-semibold">Admin PPID</span>
                    </div>
                </div>
                <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto">
                    <a href="#" @click.prevent="adminTab = 'proses'" :class="{'active': adminTab === 'proses'}" class="sidebar-link flex items-center px-4 py-2.5 rounded-lg transition-colors duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" /></svg>
                        Proses Permintaan
                    </a>
                    <a href="#" @click.prevent="adminTab = 'laporan'" :class="{'active': adminTab === 'laporan'}" class="sidebar-link flex items-center px-4 py-2.5 rounded-lg transition-colors duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z" /><path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z" /></svg>
                        Laporan & Statistik
                    </a>
                </nav>
                <div class="p-4 mt-auto border-t border-gray-700">
                    <a href="#" @click.prevent="logout()" class="sidebar-link flex items-center px-4 py-2.5 rounded-lg transition-colors duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd" /></svg>
                        Keluar
                    </a>
                </div>
            </aside>

            <!-- Main content -->
            <div class="flex-1 flex flex-col overflow-hidden">
                <header class="bg-white shadow-sm p-4">
                     <div class="flex items-center justify-between">
                        <h1 class="text-2xl font-bold text-gray-800" x-text="pageTitle"></h1>
                        <div x-show="adminTab === 'proses'" class="relative w-full max-w-xs">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
                            </div>
                            <input type="text" x-model="searchTerm" placeholder="Cari berdasarkan ID atau OPD..." class="w-full pl-10 pr-4 py-2 border rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </header>
                <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-6">
                    <!-- PROSES PERMINTAAN TAB -->
                    <div x-show="adminTab === 'proses'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                            <div class="stat-card bg-blue-500 text-white p-6 rounded-xl shadow-lg flex items-center justify-between">
                                <div>
                                    <div class="text-4xl font-extrabold" x-text="totalRequests"></div>
                                    <div class="text-sm font-medium uppercase tracking-wider">Total Permintaan</div>
                                </div>
                                <svg class="w-12 h-12 opacity-50" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 9.75h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5m-16.5-15h16.5a1.5 1.5 0 011.5 1.5v16.5a1.5 1.5 0 01-1.5 1.5H3.75a1.5 1.5 0 01-1.5-1.5V6a1.5 1.5 0 011.5-1.5z" /></svg>
                            </div>
                            <div class="stat-card bg-yellow-500 text-white p-6 rounded-xl shadow-lg flex items-center justify-between">
                                <div>
                                    <div class="text-4xl font-extrabold" x-text="newRequestsCount"></div>
                                    <div class="text-sm font-medium uppercase tracking-wider">Permintaan Baru</div>
                                </div>
                                <svg class="w-12 h-12 opacity-50" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" /></svg>
                            </div>
                            <div class="stat-card bg-indigo-500 text-white p-6 rounded-xl shadow-lg flex items-center justify-between">
                                <div>
                                    <div class="text-4xl font-extrabold" x-text="processingRequestsCount"></div>
                                    <div class="text-sm font-medium uppercase tracking-wider">Sedang Diproses</div>
                                </div>
                                <svg class="w-12 h-12 opacity-50" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.667 0l3.181-3.183m-4.991-2.691V5.25a3.375 3.375 0 00-3.375-3.375H8.25a3.375 3.375 0 00-3.375 3.375v3.192m12.375 0c.375.623.625 1.292.625 2.008v4.992a3.375 3.375 0 01-3.375 3.375H8.25a3.375 3.375 0 01-3.375-3.375v-4.992c0-.716.25-1.385.625-2.008m12.375 0h-4.992" /></svg>
                            </div>
                            <div class="stat-card bg-green-500 text-white p-6 rounded-xl shadow-lg flex items-center justify-between">
                                <div>
                                    <div class="text-4xl font-extrabold" x-text="completedRequestsCount"></div>
                                    <div class="text-sm font-medium uppercase tracking-wider">Selesai</div>
                                </div>
                                <svg class="w-12 h-12 opacity-50" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow-md overflow-hidden">
                            <table class="w-full text-sm text-left text-gray-500">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">ID Permintaan</th>
                                        <th scope="col" class="px-6 py-3">Tanggal</th>
                                        <th scope="col" class="px-6 py-3">OPD Tujuan</th>
                                        <th scope="col" class="px-6 py-3">Jenis Pemohon</th>
                                        <th scope="col" class="px-6 py-3 text-center">Status</th>
                                        <th scope="col" class="px-6 py-3 text-center">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template x-for="request in filteredRequests" :key="request.id">
                                        <tr class="bg-white border-b hover:bg-gray-50">
                                            <td class="px-6 py-4 font-medium text-gray-900" x-text="request.id"></td>
                                            <td class="px-6 py-4" x-text="request.date"></td>
                                            <td class="px-6 py-4" x-text="request.opd"></td>
                                            <td class="px-6 py-4 capitalize" x-text="request.type"></td>
                                            <td class="px-6 py-4 text-center">
                                                <span class="px-3 py-1 text-xs font-medium rounded-full" :class="statusClass(request.status)" x-text="request.status"></span>
                                            </td>
                                            <td class="px-6 py-4 text-center">
                                                <button @click="viewRequest(request)" class="font-medium text-blue-600 hover:underline">Lihat Detail</button>
                                            </td>
                                        </tr>
                                    </template>
                                    <template x-if="!filteredRequests.length">
                                        <tr>
                                            <td colspan="6" class="text-center py-10 text-gray-500">
                                                <p class="font-semibold">Tidak Ditemukan</p>
                                                <p class="text-sm">Tidak ada data yang cocok dengan pencarian Anda.</p>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- LAPORAN & STATISTIK TAB -->
                    <div x-show="adminTab === 'laporan'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
                        <!-- KPI Section -->
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Key Performance Indicators (KPI)</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                             <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                                 <div class="bg-blue-100 p-3 rounded-full mr-4">
                                     <svg class="h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                 </div>
                                 <div>
                                     <p class="text-sm text-gray-500">Rata-rata Waktu Respons</p>
                                     <p class="text-2xl font-bold text-gray-800" x-text="`${kpi.avgResponseTime} Hari`"></p>
                                 </div>
                             </div>
                              <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                                 <div class="bg-green-100 p-3 rounded-full mr-4">
                                     <svg class="h-6 w-6 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                 </div>
                                 <div>
                                     <p class="text-sm text-gray-500">Penyelesaian Tepat Waktu</p>
                                     <p class="text-2xl font-bold text-gray-800" x-text="`${kpi.onTimeCompletionRate}%`"></p>
                                 </div>
                             </div>
                              <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                                 <div class="bg-red-100 p-3 rounded-full mr-4">
                                    <svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" /></svg>
                                 </div>
                                 <div>
                                     <p class="text-sm text-gray-500">Permintaan Ditolak</p>
                                     <p class="text-2xl font-bold text-gray-800" x-text="kpi.rejectedRate"></p>
                                 </div>
                             </div>
                             <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                                 <div class="bg-yellow-100 p-3 rounded-full mr-4">
                                    <svg class="h-6 w-6 text-yellow-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.324h5.388a.563.563 0 01.328.958l-4.287 3.111a.562.562 0 00-.177.545l1.583 4.93a.562.562 0 01-.814.62l-4.52-3.26a.562.562 0 00-.652 0l-4.52 3.26a.562.562 0 01-.814-.62l1.584-4.93a.562.562 0 00-.177-.545L2.341 9.893a.562.562 0 01.328-.958h5.388a.562.562 0 00.475-.324L11.48 3.5z" /></svg>
                                 </div>
                                 <div>
                                     <p class="text-sm text-gray-500">Rata-rata Penilaian</p>
                                     <p class="text-2xl font-bold text-gray-800" x-text="kpi.avgUserRating"></p>
                                 </div>
                             </div>
                        </div>

                        <!-- Charts Section -->
                        <h2 class="text-xl font-semibold text-gray-800 mb-4 mt-8">Visualisasi Data</h2>
                        <div class="grid grid-cols-1 gap-6">
                            <!-- Chart 1: Permintaan per OPD -->
                            <div class="bg-white p-6 rounded-lg shadow-md">
                                <h3 class="font-semibold mb-4 text-gray-700">Jumlah Permintaan per OPD</h3>
                                <div class="space-y-4">
                                    <template x-for="stat in stats.byOPD" :key="stat.opd">
                                        <div>
                                            <div class="flex justify-between items-center mb-1 text-sm">
                                                <span class="font-medium text-gray-700" x-text="stat.opd"></span>
                                                <span class="text-xs font-semibold text-gray-500" x-text="`${stat.count} Permintaan`"></span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                                <div class="bg-blue-500 h-2.5 rounded-full" :style="`width: ${stat.percentage}%`"></div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <!-- Chart 2: Komposisi Jenis Pemohon -->
                            <div class="bg-white p-6 rounded-lg shadow-md">
                                <h3 class="font-semibold mb-4 text-gray-700">Komposisi Jenis Pemohon</h3>
                                <div class="space-y-4">
                                     <template x-for="stat in stats.byType" :key="stat.type">
                                        <div>
                                            <div class="flex justify-between items-center mb-1 text-sm">
                                                <span class="font-medium text-gray-700 capitalize" x-text="stat.type"></span>
                                                <span class="text-xs font-semibold text-gray-500" x-text="`${stat.count} Pemohon`"></span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                                <div class="bg-indigo-500 h-2.5 rounded-full" :style="`width: ${stat.percentage}%`"></div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>

            <!-- Modal for Request Details -->
            <div x-show="isModalOpen" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4" x-cloak>
                <div @click.away="closeModal()" class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col">
                    <div class="flex justify-between items-center p-5 border-b sticky top-0 bg-white">
                        <h3 class="text-xl font-semibold text-gray-900">Detail Permintaan: <span x-text="selectedRequest.id"></span></h3>
                        <button @click="closeModal()" class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                    </div>
                    <div class="p-6 space-y-6 overflow-y-auto" x-if="selectedRequest.id">
                        <!-- SSO Data Section -->
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="text-base font-semibold text-gray-800 mb-3">Data Pemohon (SSO)</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                <div>
                                    <p class="font-semibold text-gray-700">Nama Lengkap:</p>
                                    <p x-text="selectedRequest.name"></p>
                                </div>
                                <div>
                                    <p class="font-semibold text-gray-700">Alamat Email:</p>
                                    <p x-text="selectedRequest.email"></p>
                                </div>
                                <div>
                                    <p class="font-semibold text-gray-700">Nomor Whatsapp:</p>
                                    <p x-text="selectedRequest.phone"></p>
                                </div>
                            </div>
                        </div>

                        <!-- Detail Permohonan Section -->
                        <h4 class="text-base font-semibold text-gray-800 pt-2">Detail Isian Formulir</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                            <div class="space-y-4">
                                <div><p class="font-semibold text-gray-700">Tanggal:</p><p x-text="selectedRequest.date"></p></div>
                                <div><p class="font-semibold text-gray-700">OPD Tujuan:</p><p x-text="selectedRequest.opd"></p></div>
                                <div><p class="font-semibold text-gray-700">Status:</p><span class="px-3 py-1 text-xs font-medium rounded-full" :class="statusClass(selectedRequest.status)" x-text="selectedRequest.status"></span></div>
                            </div>
                            <div class="space-y-4">
                                <div><p class="font-semibold text-gray-700">Jenis Pemohon:</p><p class="capitalize" x-text="selectedRequest.type"></p></div>
                                <div><p class="font-semibold text-gray-700">No. KTP:</p><p x-text="selectedRequest.nik"></p></div>
                                <div><p class="font-semibold text-gray-700">Alamat:</p><p x-text="selectedRequest.address"></p></div>
                            </div>
                        </div>
                        <hr>
                        <div>
                             <p class="font-semibold text-gray-700">Dokumen Terlampir:</p>
                             <div class="flex flex-col space-y-2 mt-1">
                                 <a href="#" class="flex items-center text-blue-600 hover:underline">Scan KTP.jpg</a>
                                 <a href="#" x-show="selectedRequest.supportingDoc" class="flex items-center text-blue-600 hover:underline" x-cloak>
                                     <span x-text="selectedRequest.supportingDoc"></span>
                                 </a>
                             </div>
                        </div>
                         <hr>
                        <div><p class="font-semibold text-gray-700">Informasi Diminta:</p><p class="mt-1 bg-gray-50 p-3 rounded-lg" x-text="selectedRequest.requestText"></p></div>
                        <div><p class="font-semibold text-gray-700">Alasan Permintaan:</p><p class="mt-1 bg-gray-50 p-3 rounded-lg" x-text="selectedRequest.reasonText"></p></div>
                    </div>
                    <div class="flex items-center justify-end p-5 border-t space-x-4 bg-gray-50 rounded-b-lg sticky bottom-0">
                        <select x-model="selectedRequest.status" class="w-full md:w-auto p-2 border border-gray-300 rounded-md text-sm">
                            <option value="Baru">Baru</option>
                            <option value="Diproses">Diproses</option>
                            <option value="Selesai">Selesai</option>
                            <option value="Ditolak">Ditolak</option>
                        </select>
                        <button @click="updateRequestStatus()" type="button" class="px-5 py-2.5 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700">Simpan Status</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ===== TRACKING VIEW ===== -->
    <main x-show="currentPage === 'tracking'" x-transition.opacity>
        <div class="min-h-screen bg-slate-50">
            <header class="bg-white shadow-md">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex items-center justify-between h-20">
                         <div class="flex items-center">
                            <img class="h-12 w-auto" src="https://layanan-diskominfo.kalbarprov.go.id/PPIDKALBAR-PERMOHONAN/public/assets/images/cropped-kalbar-200x200.png" alt="Logo Kalbar">
                            <div class="ml-4">
                                <h1 class="text-xl font-extrabold text-gray-800">Lacak Status Permintaan</h1>
                            </div>
                        </div>
                        <button @click="currentPage = 'login'; trackingResult = null; trackingId = ''" class="inline-flex items-center gap-2 text-sm font-medium text-blue-600 hover:text-blue-700 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                            Kembali ke Login
                        </button>
                    </div>
                </div>
            </header>
            <div class="container mx-auto p-4 sm:p-6 lg:p-8">
                <div class="max-w-xl mx-auto">
                    <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg">
                        <form @submit.prevent="trackRequest()">
                            <label for="trackingId" class="block text-sm font-medium text-gray-700">Masukkan ID Permintaan Anda</label>
                            <div class="mt-2 flex gap-2">
                                <input type="text" x-model="trackingId" id="trackingId" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" placeholder="Contoh: PPID-2025-001">
                                <button type="submit" class="rounded-md bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500">Lacak</button>
                            </div>
                        </form>
                    </div>

                    <div x-show="trackingResult" x-transition class="mt-6">
                        <template x-if="trackingResult && trackingResult.error">
                            <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg shadow-md">
                                <p x-text="trackingResult.error"></p>
                            </div>
                        </template>

                        <template x-if="trackingResult && !trackingResult.error">
                            <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg">
                                <h3 class="text-lg font-semibold text-gray-900">Riwayat Status untuk <span x-text="trackingResult.id" class="text-blue-600"></span></h3>
                                <p class="text-sm text-gray-500 mt-1">OPD Tujuan: <span x-text="trackingResult.opd" class="font-medium"></span></p>
                                <div class="mt-6 border-l-2 border-blue-200">
                                    <template x-for="(history, index) in trackingResult.statusHistory" :key="index">
                                        <div class="relative pl-8 pb-8">
                                            <div class="absolute -left-2.5 top-1 h-5 w-5 rounded-full" :class="index === 0 ? 'bg-blue-500 ring-4 ring-white' : 'bg-gray-300'"></div>
                                            <p class="font-semibold" :class="index === 0 ? 'text-blue-600' : 'text-gray-700'" x-text="history.status"></p>
                                            <p class="text-sm text-gray-500" x-text="history.date"></p>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ===== PROCESS VIEW ===== -->
    <main x-show="currentPage === 'process'" x-transition.opacity>
         <div class="bg-slate-50 min-h-screen">
            <header class="bg-white shadow-sm sticky top-0 z-10">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex items-center justify-between h-20">
                        <div class="flex items-center">
                            <img class="h-12 w-auto" src="https://layanan-diskominfo.kalbarprov.go.id/PPIDKALBAR-PERMOHONAN/public/assets/images/cropped-kalbar-200x200.png" alt="Logo Kalbar">
                            <div class="ml-4">
                                <h1 class="text-xl font-extrabold text-gray-800">Proses Bisnis Aplikasi PPID</h1>
                            </div>
                        </div>
                        <button @click="currentPage = 'login'" class="inline-flex items-center gap-2 text-sm font-medium text-blue-600 hover:text-blue-700 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                            Kembali ke Login
                        </button>
                    </div>
                </div>
            </header>
            <div class="container mx-auto p-4 sm:p-6 lg:p-8">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
                    <!-- Alur Pemohon -->
                    <div class="space-y-4">
                        <h2 class="text-2xl font-bold text-center text-gray-800">Alur Pemohon Informasi</h2>
                        <div class="flex flex-col items-center">
                            <!-- Step 1 -->
                            <div class="bg-white p-4 rounded-lg shadow-md w-full max-w-sm flex items-start space-x-4">
                                <div class="bg-blue-100 text-blue-600 p-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg></div>
                                <div><h4 class="font-semibold">Login</h4><p class="text-sm text-gray-600">Pilih metode login (SSO ASN/SSO Masyarakat).</p></div>
                            </div>
                            <div class="h-8 w-px bg-gray-300"></div>
                            <!-- Step 2 -->
                             <div class="bg-white p-4 rounded-lg shadow-md w-full max-w-sm flex items-start space-x-4">
                                <div class="bg-blue-100 text-blue-600 p-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg></div>
                                <div><h4 class="font-semibold">Isi Formulir</h4><p class="text-sm text-gray-600">Lengkapi detail permintaan dan unggah dokumen pendukung.</p></div>
                            </div>
                            <div class="h-8 w-px bg-gray-300"></div>
                            <!-- Step 3 -->
                             <div class="bg-white p-4 rounded-lg shadow-md w-full max-w-sm flex items-start space-x-4">
                                <div class="bg-blue-100 text-blue-600 p-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" /></svg></div>
                                <div><h4 class="font-semibold">Kirim Permintaan</h4><p class="text-sm text-gray-600">Dapatkan notifikasi berhasil dan ID pelacakan.</p></div>
                            </div>
                             <div class="h-8 w-px bg-gray-300"></div>
                            <!-- Step 4 -->
                             <div class="bg-white p-4 rounded-lg shadow-md w-full max-w-sm flex items-start space-x-4">
                                <div class="bg-blue-100 text-blue-600 p-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg></div>
                                <div><h4 class="font-semibold">Beri Penilaian</h4><p class="text-sm text-gray-600">Berikan feedback untuk peningkatan layanan.</p></div>
                            </div>
                        </div>
                    </div>
                     <!-- Alur Admin -->
                    <div class="space-y-4">
                         <h2 class="text-2xl font-bold text-center text-gray-800">Alur Admin PPID</h2>
                          <div class="flex flex-col items-center">
                            <!-- Step 1 -->
                            <div class="bg-white p-4 rounded-lg shadow-md w-full max-w-sm flex items-start space-x-4">
                                <div class="bg-red-100 text-red-600 p-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 8a6 6 0 11-12 0 6 6 0 0112 0zM7 8a4 4 0 118 0 4 4 0 01-8 0zM4.93 14.07a8.001 8.001 0 0010.14 0A8.001 8.001 0 004.93 14.07z" clip-rule="evenodd" /></svg></div>
                                <div><h4 class="font-semibold">Login Admin</h4><p class="text-sm text-gray-600">Masuk ke dasbor dengan akun admin.</p></div>
                            </div>
                            <div class="h-8 w-px bg-gray-300"></div>
                            <!-- Step 2 -->
                             <div class="bg-white p-4 rounded-lg shadow-md w-full max-w-sm flex items-start space-x-4">
                                <div class="bg-red-100 text-red-600 p-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z" /></svg></div>
                                <div><h4 class="font-semibold">Kelola Permintaan</h4><p class="text-sm text-gray-600">Lihat detail, periksa dokumen, dan ubah status permintaan.</p></div>
                            </div>
                            <div class="h-8 w-px bg-gray-300"></div>
                            <!-- Step 3 -->
                             <div class="bg-white p-4 rounded-lg shadow-md w-full max-w-sm flex items-start space-x-4">
                                <div class="bg-red-100 text-red-600 p-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z" /><path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z" /></svg></div>
                                <div><h4 class="font-semibold">Analisis Laporan</h4><p class="text-sm text-gray-600">Pantau KPI dan analisis data statistik untuk evaluasi.</p></div>
                            </div>
                             <div class="h-8 w-px bg-gray-300"></div>
                            <!-- Step 4 -->
                             <div class="bg-white p-4 rounded-lg shadow-md w-full max-w-sm flex items-start space-x-4">
                                <div class="bg-red-100 text-red-600 p-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" /></svg></div>
                                <div><h4 class="font-semibold">Beri Dukungan</h4><p class="text-sm text-gray-600">Respons pertanyaan pengguna melalui WhatsApp.</p></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
         </div>
    </main>
    
    <script>
        function appData() {
            const blankRequest = { id: '', date: '', opd: '', type: '', status: '', name: '', email: '', phone: '', nik: '', address: '', supportingDoc: null, requestText: '', reasonText: '', completionDays: null, statusHistory: [] };
            return {
                // APP STATE
                currentPage: 'login', userType: null, adminTab: 'proses',
                // FORM STATE
                newRequest: { opd: '', type: '', nik: '', address: '', requestText: '', reasonText: ''},
                files: { ktp: null, supportingDoc: null },
                isDraggingKTP: false, isDraggingDoc: false,
                isSubmitting: false, formSuccess: false, lastRequestId: '',
                userFeedback: { rating: 0, comment: '' },
                feedbackSubmitted: false,
                feedbacks: [
                    { requestId: 'PPID-2025-001', rating: 5, comment: 'Sangat cepat dan informatif!' },
                    { requestId: 'PPID-2025-003', rating: 4, comment: 'Cukup membantu.' },
                    { requestId: 'PPID-2025-006', rating: 5, comment: 'Luar biasa.' },
                ],
                // TRACKING STATE
                trackingId: '',
                trackingResult: null,
                // DASHBOARD STATE
                isModalOpen: false, searchTerm: '', selectedRequest: { ...blankRequest },
                requests: [
                    { id: 'PPID-2025-001', date: '27/07/2025', opd: 'Dinas Komunikasi Dan Informatika Prov. Kalbar', type: 'perorangan', status: 'Selesai', name: 'Budi Santoso', email: 'budi.s@email.com', phone: '081234567890', nik: '617101******0001', address: 'Jl. Ahmad Yani No.1, Pontianak', supportingDoc: null, requestText: 'Data statistik pengguna internet di Kalimantan Barat per triwulan selama tahun 2024.', reasonText: 'Untuk keperluan penelitian akademis.', completionDays: 5, statusHistory: [{status: 'Selesai', date: '01/08/2025'}, {status: 'Diproses', date: '28/07/2025'}, {status: 'Baru', date: '27/07/2025'}] },
                    { id: 'PPID-2025-002', date: '26/07/2025', opd: 'Badan Perencanaan Pembangunan Daerah Prov. Kalbar', type: 'badan-hukum', status: 'Diproses', name: 'Citra Wulandari', email: 'citra.w@email.com', phone: '081234567891', nik: '617102******0002', address: 'Jl. Gajah Mada No. 20', supportingDoc: 'Akta Pendirian PT.pdf', requestText: 'Salinan dokumen RPJMD Provinsi Kalbar terbaru.', reasonText: 'Sebagai bahan acuan penyusunan rencana strategis.', completionDays: null, statusHistory: [{status: 'Diproses', date: '27/07/2025'}, {status: 'Baru', date: '26/07/2025'}] },
                    { id: 'PPID-2025-003', date: '25/07/2025', opd: 'Dinas Pendidikan Dan Kebudayaan Prov. Kalbar', type: 'kelompok', status: 'Selesai', name: 'Ahmad Subarjo', email: 'ahmad.s@email.com', phone: '081234567892', nik: '617103******0003', address: 'Jl. Imam Bonjol No. 15', supportingDoc: 'Surat Kuasa Kelompok.pdf', requestText: 'Data jumlah sekolah dan siswa jenjang SMA/SMK.', reasonText: 'Untuk kegiatan advokasi pendidikan.', completionDays: 12, statusHistory: [{status: 'Selesai', date: '06/08/2025'}, {status: 'Diproses', date: '26/07/2025'}, {status: 'Baru', date: '25/07/2025'}] },
                    { id: 'PPID-2025-004', date: '24/07/2025', opd: 'Dinas Kesehatan Prov. Kalbar', type: 'perorangan', status: 'Ditolak', name: 'Dewi Lestari', email: 'dewi.l@email.com', phone: '081234567893', nik: '617104******0004', address: 'Jl. Dr. Sutomo No. 5', supportingDoc: null, requestText: 'Data rekam medis pasien COVID-19.', reasonText: 'Penelitian pribadi (Informasi dikecualikan).', completionDays: 2, statusHistory: [{status: 'Ditolak', date: '26/07/2025'}, {status: 'Baru', date: '24/07/2025'}] },
                    { id: 'PPID-2025-005', date: '23/07/2025', opd: 'Badan Kepegawaian Daerah Prov. Kalbar', type: 'instansi', status: 'Baru', name: 'Eko Prasetyo', email: 'eko.p@email.com', phone: '081234567894', nik: '617105******0005', address: 'Jl. Urai Bawadi No. 9', supportingDoc: 'Surat Tugas BKD.pdf', requestText: 'Informasi mengenai jumlah formasi CPNS dan P3K 2024.', reasonText: 'Persiapan untuk mengikuti seleksi CASN.', completionDays: null, statusHistory: [{status: 'Baru', date: '23/07/2025'}] },
                    { id: 'PPID-2025-006', date: '22/07/2025', opd: 'Dinas Komunikasi Dan Informatika Prov. Kalbar', type: 'kelompok', status: 'Selesai', name: 'Fitriani', email: 'fitriani@email.com', phone: '081234567895', nik: '617106******0006', address: 'Jl. Sutan Syahrir No. 3', supportingDoc: 'Surat Tugas LSM ABC.pdf', requestText: 'Data jumlah penyandang disabilitas di Kubu Raya.', reasonText: 'Untuk evaluasi program kerja LSM.', completionDays: 8, statusHistory: [{status: 'Selesai', date: '30/07/2025'}, {status: 'Diproses', date: '23/07/2025'}, {status: 'Baru', date: '22/07/2025'}] }
                ],
                // LOGIN & NAVIGATION
                login(type) { this.userType = type; this.currentPage = type === 'admin' ? 'dashboard' : 'form'; },
                logout() { this.userType = null; this.currentPage = 'login'; this.formSuccess = false; this.feedbackSubmitted = false; this.resetForm(); },
                // FORM METHODS
                submitRequest() {
                    this.isSubmitting = true;
                    setTimeout(() => { // Simulate API call
                        const newId = `PPID-2025-${(this.requests.length + 1).toString().padStart(3, '0')}`;
                        const newEntry = { id: newId, date: new Date().toLocaleDateString('id-ID'), status: 'Baru', ...this.newRequest, name: 'Pengguna Baru', email: 'pengguna@sso.com', phone: '081200000000', completionDays: null, statusHistory: [{ status: 'Baru', date: new Date().toLocaleDateString('id-ID') }] };
                        this.requests.unshift(newEntry);
                        this.formSuccess = true;
                        this.lastRequestId = newId;
                        this.resetForm();
                        this.isSubmitting = false;
                        window.scrollTo(0, 0);
                    }, 1500);
                },
                 submitFeedback() {
                    this.feedbacks.push({
                        requestId: this.lastRequestId,
                        rating: this.userFeedback.rating,
                        comment: this.userFeedback.comment
                    });
                    this.feedbackSubmitted = true;
                },
                resetForm() {
                    this.newRequest = { opd: '', type: '', nik: '', address: '', requestText: '', reasonText: ''};
                    this.files = { ktp: null, supportingDoc: null };
                    this.userFeedback = { rating: 0, comment: '' };
                },
                handleFileDrop(e, inputId) {
                    const file = e.dataTransfer.files[0];
                    if (inputId === 'ktp-upload') this.files.ktp = file;
                    else this.files.supportingDoc = file;
                },
                // TRACKING METHOD
                trackRequest() {
                    if (!this.trackingId) {
                        this.trackingResult = { error: 'Silakan masukkan ID Permintaan.' };
                        return;
                    }
                    const foundRequest = this.requests.find(r => r.id.toLowerCase() === this.trackingId.toLowerCase());
                    if (foundRequest) {
                        this.trackingResult = foundRequest;
                    } else {
                        this.trackingResult = { error: `Permintaan dengan ID "${this.trackingId}" tidak ditemukan.` };
                    }
                },
                // COMPUTED PROPERTIES (GETTERS)
                get pageTitle() {
                    const titles = {
                        'proses': 'Proses Permintaan Informasi',
                        'laporan': 'Laporan & Statistik'
                    };
                    return titles[this.adminTab] || 'Dasbor Admin';
                },
                get applicantTypes() {
                    const common = [{ value: 'perorangan', label: 'Perorangan' }];
                    if (this.userType === 'asn') return [...common, { value: 'instansi', label: 'Instansi' }];
                    if (this.userType === 'non-asn') return [...common, { value: 'badan-hukum', label: 'Badan Hukum' }, { value: 'kelompok', label: 'Kelompok' }];
                    return [];
                },
                get supportingDocLabel() {
                    const labels = { 'instansi': 'Scan Surat Tugas / Dokumen Resmi', 'badan-hukum': 'Scan Akta Pendirian', 'kelompok': 'Scan Surat Kuasa' };
                    return labels[this.newRequest.type] || 'Dokumen Pendukung';
                },
                get totalRequests() { return this.requests.length; },
                get newRequestsCount() { return this.requests.filter(r => r.status === 'Baru').length; },
                get processingRequestsCount() { return this.requests.filter(r => r.status === 'Diproses').length; },
                get completedRequestsCount() { return this.requests.filter(r => r.status === 'Selesai').length; },
                get filteredRequests() {
                    if (this.searchTerm === '') return this.requests;
                    const term = this.searchTerm.toLowerCase();
                    return this.requests.filter(req => req.id.toLowerCase().includes(term) || req.opd.toLowerCase().includes(term));
                },
                // STATISTICS & KPI GETTERS
                get kpi() {
                    const completed = this.requests.filter(r => r.completionDays !== null);
                    const totalResponseTime = completed.reduce((sum, r) => sum + r.completionDays, 0);
                    const avgResponseTime = completed.length > 0 ? (totalResponseTime / completed.length).toFixed(1) : 0;
                    
                    const onTime = completed.filter(r => r.completionDays <= 10).length;
                    const onTimeCompletionRate = completed.length > 0 ? ((onTime / completed.length) * 100).toFixed(0) : 0;
                    
                    const rejectedCount = this.requests.filter(r => r.status === 'Ditolak').length;

                    const totalRatings = this.feedbacks.reduce((sum, f) => sum + f.rating, 0);
                    const avgUserRating = this.feedbacks.length > 0 ? (totalRatings / this.feedbacks.length).toFixed(1) : 'N/A';

                    return { avgResponseTime, onTimeCompletionRate, rejectedRate: rejectedCount, avgUserRating };
                },
                get stats() {
                    const byOPD = this.requests.reduce((acc, req) => {
                        acc[req.opd] = (acc[req.opd] || 0) + 1;
                        return acc;
                    }, {});

                    const byType = this.requests.reduce((acc, req) => {
                        acc[req.type] = (acc[req.type] || 0) + 1;
                        return acc;
                    }, {});
                    
                    const totalRequests = this.requests.length;

                    return {
                        byOPD: Object.entries(byOPD).map(([opd, count]) => ({ opd, count, percentage: totalRequests > 0 ? (count / totalRequests) * 100 : 0 })).sort((a, b) => b.count - a.count),
                        byType: Object.entries(byType).map(([type, count]) => ({ type, count, percentage: totalRequests > 0 ? (count / totalRequests) * 100 : 0 })).sort((a,b) => b.count - a.count)
                    };
                },
                // DASHBOARD METHODS
                statusClass(status) {
                    const classes = { 'Baru': 'bg-blue-100 text-blue-800', 'Diproses': 'bg-yellow-100 text-yellow-800', 'Selesai': 'bg-green-100 text-green-800', 'Ditolak': 'bg-red-100 text-red-800' };
                    return classes[status] || 'bg-gray-100 text-gray-800';
                },
                viewRequest(request) { this.selectedRequest = { ...request }; this.isModalOpen = true; },
                closeModal() { this.isModalOpen = false; },
                updateRequestStatus() {
                    const index = this.requests.findIndex(req => req.id === this.selectedRequest.id);
                    if (index !== -1) {
                         if (this.requests[index].status !== this.selectedRequest.status) {
                            this.requests[index].status = this.selectedRequest.status;
                            this.requests[index].statusHistory.unshift({
                                status: this.selectedRequest.status,
                                date: new Date().toLocaleDateString('id-ID')
                            });
                        }
                    }
                    this.closeModal();
                }
            };
        }
    </script>
</body>
</html>
