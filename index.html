<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi PPID | Provinsi Kalimantan Barat</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js for Interactivity (with defer attribute) -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="https://layanan-diskominfo.kalbarprov.go.id/PPIDKALBAR-PERMOHONAN/public/assets/images/cropped-kalbar-200x200.png">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }
        [x-cloak] { display: none !important; }
        .sidebar-link:hover, .sidebar-link.active {
            background-color: #3b82f6; /* blue-500 */
            color: white;
        }
        .stat-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        /* Custom spinner */
        .spinner {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            width: 16px;
            height: 16px;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>

<body x-data="appData()" x-cloak>

    <!-- ===== LOGIN VIEW ===== -->
    <main x-show="currentPage === 'login'" x-transition.opacity>
        <div class="flex items-center justify-center min-h-screen bg-slate-100">
            <div class="w-full max-w-md p-8 space-y-8 bg-white rounded-2xl shadow-lg">
                <div class="text-center">
                    <img src="https://layanan-diskominfo.kalbarprov.go.id/PPIDKALBAR-PERMOHONAN/public/assets/images/cropped-kalbar-200x200.png" alt="Logo Kalbar" class="w-24 h-24 mx-auto mb-4">
                    <h1 class="text-2xl font-bold text-gray-800">Akses Formulir PPID</h1>
                    <p class="mt-2 text-sm text-gray-500">Silakan masuk untuk melanjutkan</p>
                </div>
                <div class="space-y-4">
                    <button @click="login('admin')" class="w-full flex items-center justify-center px-4 py-3 font-semibold text-white bg-red-600 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-300">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                        Masuk sebagai Admin
                    </button>
                    <button @click="login('asn')" class="w-full flex items-center justify-center px-4 py-3 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-300">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-6-6h6a6 6 0 00-6 6z"></path></svg>
                        SSO ASN
                    </button>
                    <button @click="login('non-asn')" class="w-full flex items-center justify-center px-4 py-3 font-semibold text-white bg-gray-600 rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors duration-300">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                        SSO Non-ASN
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- ===== USER FORM VIEW ===== -->
    <main x-show="currentPage === 'form'" x-transition.opacity>
        <div class="min-h-screen bg-slate-50">
            <header class="bg-white shadow-md sticky top-0 z-10">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex items-center justify-between h-20">
                        <div class="flex items-center">
                            <img class="h-12 w-auto" src="https://layanan-diskominfo.kalbarprov.go.id/PPIDKALBAR-PERMOHONAN/public/assets/images/cropped-kalbar-200x200.png" alt="Logo Kalbar">
                            <div class="ml-4">
                                <h2 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">PEMERINTAH PROVINSI KALIMANTAN BARAT</h2>
                                <h1 class="text-xl font-bold text-gray-800">Formulir Permintaan Informasi</h1>
                            </div>
                        </div>
                        <button @click="logout()" class="text-sm font-medium text-gray-600 hover:text-blue-600 transition-colors">
                            Logout
                        </button>
                    </div>
                </div>
            </header>

            <div class="container mx-auto p-4 sm:p-6 lg:p-8">
                <div x-show="formSuccess" class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded-lg mb-6" role="alert">
                    <p class="font-bold">Berhasil!</p>
                    <p>Permintaan Anda telah berhasil dikirim dengan ID: <span x-text="lastRequestId"></span></p>
                </div>

                <form @submit.prevent="submitRequest" class="bg-white p-8 rounded-2xl shadow-lg space-y-8">
                    <!-- Section 1 -->
                    <div class="border-b border-gray-900/10 pb-8">
                        <h2 class="text-base font-semibold leading-7 text-gray-900">Informasi Pemohon</h2>
                        <p class="mt-1 text-sm leading-6 text-gray-600">Data Anda (Nama, Email, Whatsapp) telah terisi otomatis melalui sistem SSO.</p>

                        <div class="mt-6 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6">
                            <div class="sm:col-span-3">
                                <label for="opd_tujuan" class="block text-sm font-medium leading-6 text-gray-900">OPD Tujuan <span class="text-red-500">*</span></label>
                                <div class="mt-2">
                                    <select x-model="newRequest.opd" id="opd_tujuan" required class="block w-full rounded-md border-0 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6">
                                        <option value="">:: Pilih OPD ::</option>
                                        <optgroup label="Pemerintah Prov. Kalbar">
                                            <option>Badan Kepegawaian Daerah Prov. Kalbar</option>
                                            <option>Dinas Komunikasi Dan Informatika Prov. Kalbar</option>
                                            <option>Dinas Kesehatan Prov. Kalbar</option>
                                            <option>Badan Perencanaan Pembangunan Daerah Prov. Kalbar</option>
                                        </optgroup>
                                        <optgroup label="Pemerintah Kab/Kota">
                                            <option>Pemerintah Kota Pontianak</option>
                                            <option>Pemerintah Kota Singkawang</option>
                                        </optgroup>
                                    </select>
                                </div>
                            </div>

                            <div class="sm:col-span-3">
                                <label for="jenis_pemohon" class="block text-sm font-medium leading-6 text-gray-900">Jenis Pemohon <span class="text-red-500">*</span></label>
                                <div class="mt-2">
                                    <select x-model="newRequest.type" id="jenis_pemohon" required class="block w-full rounded-md border-0 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6">
                                        <option value="">:: Pilih Jenis ::</option>
                                        <template x-for="option in applicantTypes" :key="option.value">
                                            <option :value="option.value" x-text="option.label"></option>
                                        </template>
                                    </select>
                                </div>
                            </div>

                             <div class="sm:col-span-3">
                                <label for="noktp" class="block text-sm font-medium leading-6 text-gray-900">No. Identitas (KTP) <span class="text-red-500">*</span></label>
                                <div class="mt-2">
                                    <input type="text" x-model="newRequest.nik" id="noktp" required class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6" placeholder="Masukkan 16 digit NIK">
                                </div>
                            </div>
                            
                            <div class="col-span-full">
                                <label for="alamat" class="block text-sm font-medium leading-6 text-gray-900">Alamat Lengkap <span class="text-red-500">*</span></label>
                                <div class="mt-2">
                                    <textarea x-model="newRequest.address" id="alamat" rows="3" required class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6" placeholder="Sesuai KTP"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section 2 -->
                    <div class="border-b border-gray-900/10 pb-8">
                        <h2 class="text-base font-semibold leading-7 text-gray-900">Rincian Permintaan Informasi</h2>
                        <p class="mt-1 text-sm leading-6 text-gray-600">Jelaskan informasi yang Anda butuhkan secara rinci.</p>
                        <div class="mt-6 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6">
                            <div class="col-span-full">
                                <label for="informasi_diminta" class="block text-sm font-medium leading-6 text-gray-900">Informasi yang Diminta <span class="text-red-500">*</span></label>
                                <div class="mt-2">
                                    <textarea x-model="newRequest.requestText" id="informasi_diminta" rows="4" required class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6"></textarea>
                                </div>
                            </div>

                            <div class="col-span-full">
                                <label for="alasan" class="block text-sm font-medium leading-6 text-gray-900">Alasan Permintaan Informasi <span class="text-red-500">*</span></label>
                                <div class="mt-2">
                                    <textarea x-model="newRequest.reasonText" id="alasan" rows="4" required class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 3 - File Uploads -->
                    <div>
                         <h2 class="text-base font-semibold leading-7 text-gray-900">Lampiran Dokumen</h2>
                         <p class="mt-1 text-sm leading-6 text-gray-600">Unggah dokumen yang diperlukan dalam format PDF atau JPG (Maks 2MB).</p>

                         <div class="mt-6 grid grid-cols-1 gap-y-8 sm:grid-cols-2 gap-x-6">
                            <!-- KTP Upload -->
                            <div>
                                <label class="block text-sm font-medium leading-6 text-gray-900">Scan Identitas (KTP) <span class="text-red-500">*</span></label>
                                <div @dragover.prevent @drop.prevent="e => handleFileDrop(e, 'ktp-upload')" class="mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 px-6 py-10">
                                    <div class="text-center">
                                         <svg class="mx-auto h-12 w-12 text-gray-300" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M1.5 6a2.25 2.25 0 012.25-2.25h16.5A2.25 2.25 0 0122.5 6v12A2.25 2.25 0 0120.25 20.25H3.75A2.25 2.25 0 011.5 18V6zM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0021 18v-1.94l-2.69-2.689a1.5 1.5 0 00-2.12 0l-.88.879.97.97a.75.75 0 11-1.06 1.06l-5.16-5.159a1.5 1.5 0 00-2.12 0L3 16.061zm10.125-7.81a1.125 1.125 0 112.25 0 1.125 1.125 0 01-2.25 0z" clip-rule="evenodd" /></svg>
                                        <div class="mt-4 flex text-sm leading-6 text-gray-600">
                                            <label for="ktp-upload" class="relative cursor-pointer rounded-md bg-white font-semibold text-blue-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-blue-600 focus-within:ring-offset-2 hover:text-blue-500">
                                                <span>Unggah file</span>
                                                <input id="ktp-upload" name="ktp-upload" type="file" class="sr-only" @change="e => files.ktp = e.target.files[0]">
                                            </label>
                                            <p class="pl-1">atau seret dan lepas</p>
                                        </div>
                                        <p class="text-xs leading-5 text-gray-600">JPG, PNG, PDF hingga 2MB</p>
                                        <p x-show="files.ktp" x-text="files.ktp?.name" class="text-sm text-green-600 mt-2"></p>
                                    </div>
                                </div>
                            </div>
                             <!-- Supporting Doc Upload -->
                            <div x-show="newRequest.type && newRequest.type !== 'perorangan'" x-transition>
                                <label class="block text-sm font-medium leading-6 text-gray-900">
                                    <span x-text="supportingDocLabel"></span>
                                    <span class="text-red-500">*</span>
                                </label>
                                <div @dragover.prevent @drop.prevent="e => handleFileDrop(e, 'supporting-doc-upload')" class="mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 px-6 py-10">
                                    <div class="text-center">
                                        <svg class="mx-auto h-12 w-12 text-gray-300" viewBox="0 0 24 24" fill="currentColor"><path d="M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0016.5 9h-1.875a1.875 1.875 0 01-1.875-1.875V5.25A3.75 3.75 0 009 1.5H5.625z" /><path d="M12.971 1.816A5.23 5.23 0 0114.25 1.5a.75.75 0 01.75.75v4.5a.75.75 0 00.75.75h4.5a.75.75 0 01.75.75 5.23 5.23 0 01-1.816 1.279l-5.455 2.296a.75.75 0 01-.913 0l-5.455-2.296A5.23 5.23 0 012.25 9a.75.75 0 01.75-.75h4.5a.75.75 0 00.75-.75v-4.5a.75.75 0 01.75-.75c.664 0 1.298.125 1.887.356a.75.75 0 01.434 1.254l-3.235 3.235a.75.75 0 001.06 1.06l3.235-3.235a.75.75 0 011.254.434z" /></svg>
                                        <div class="mt-4 flex text-sm leading-6 text-gray-600">
                                            <label for="supporting-doc-upload" class="relative cursor-pointer rounded-md bg-white font-semibold text-blue-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-blue-600 focus-within:ring-offset-2 hover:text-blue-500">
                                                <span>Unggah file</span>
                                                <input id="supporting-doc-upload" name="supporting-doc-upload" type="file" class="sr-only" @change="e => files.supportingDoc = e.target.files[0]">
                                            </label>
                                            <p class="pl-1">atau seret dan lepas</p>
                                        </div>
                                        <p class="text-xs leading-5 text-gray-600">PDF hingga 2MB</p>
                                        <p x-show="files.supportingDoc" x-text="files.supportingDoc?.name" class="text-sm text-green-600 mt-2"></p>
                                    </div>
                                </div>
                            </div>
                         </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="mt-10 flex items-center justify-end gap-x-6">
                        <button @click="logout()" type="button" class="text-sm font-semibold leading-6 text-gray-900">Batal</button>
                        <button type="submit" :disabled="isSubmitting" class="flex items-center justify-center rounded-md bg-blue-600 px-6 py-3 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600 disabled:bg-blue-300 disabled:cursor-not-allowed">
                            <div x-show="isSubmitting" class="spinner mr-2"></div>
                            <span x-text="isSubmitting ? 'Mengirim...' : 'Kirim Permintaan'"></span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- ===== ADMIN DASHBOARD VIEW ===== -->
    <main x-show="currentPage === 'dashboard'" x-transition.opacity>
        <div class="flex h-screen bg-gray-100">
            <!-- Sidebar -->
            <aside class="w-64 flex-shrink-0 bg-gray-800 text-white flex flex-col">
                <div class="h-20 flex items-center justify-center bg-gray-900 flex-shrink-0">
                    <div class="flex items-center space-x-3">
                        <img src="https://layanan-diskominfo.kalbarprov.go.id/PPIDKALBAR-PERMOHONAN/public/assets/images/cropped-kalbar-200x200.png" alt="Logo" class="h-10 w-10 rounded-full">
                        <span class="text-lg font-semibold">Admin PPID</span>
                    </div>
                </div>
                <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto">
                    <a href="#" class="sidebar-link flex items-center px-4 py-2.5 rounded-lg transition-colors duration-200 active">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                        Dasbor
                    </a>
                </nav>
                <div class="p-4 mt-auto border-t border-gray-700">
                    <a href="#" @click.prevent="logout()" class="sidebar-link flex items-center px-4 py-2.5 rounded-lg transition-colors duration-200">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H3"></path></svg>
                        Keluar
                    </a>
                </div>
            </aside>

            <!-- Main content -->
            <div class="flex-1 flex flex-col overflow-hidden">
                <header class="bg-white shadow-sm p-4">
                     <div class="flex items-center justify-between">
                        <h1 class="text-2xl font-bold text-gray-800">Dasbor Admin</h1>
                        <div class="relative w-full max-w-xs">
                            <input type="text" x-model="searchTerm" placeholder="Cari berdasarkan ID atau OPD..." class="w-full pl-10 pr-4 py-2 border rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        </div>
                    </div>
                </header>
                <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-6">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                         <div class="stat-card bg-blue-500 text-white p-6 rounded-xl shadow-lg flex items-center justify-between">
                            <div>
                                <div class="text-4xl font-extrabold" x-text="totalRequests"></div>
                                <div class="text-sm font-medium uppercase tracking-wider">Total Permintaan</div>
                            </div>
                            <svg class="w-12 h-12 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        </div>
                         <div class="stat-card bg-yellow-500 text-white p-6 rounded-xl shadow-lg flex items-center justify-between">
                            <div>
                                <div class="text-4xl font-extrabold" x-text="newRequestsCount"></div>
                                <div class="text-sm font-medium uppercase tracking-wider">Permintaan Baru</div>
                            </div>
                            <svg class="w-12 h-12 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>
                        </div>
                        <div class="stat-card bg-indigo-500 text-white p-6 rounded-xl shadow-lg flex items-center justify-between">
                            <div>
                                <div class="text-4xl font-extrabold" x-text="processingRequestsCount"></div>
                                <div class="text-sm font-medium uppercase tracking-wider">Sedang Diproses</div>
                            </div>
                            <svg class="w-12 h-12 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </div>
                        <div class="stat-card bg-green-500 text-white p-6 rounded-xl shadow-lg flex items-center justify-between">
                            <div>
                                <div class="text-4xl font-extrabold" x-text="completedRequestsCount"></div>
                                <div class="text-sm font-medium uppercase tracking-wider">Selesai</div>
                            </div>
                           <svg class="w-12 h-12 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-md overflow-hidden">
                        <table class="w-full text-sm text-left text-gray-500">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3">ID Permintaan</th>
                                    <th scope="col" class="px-6 py-3">Tanggal</th>
                                    <th scope="col" class="px-6 py-3">OPD Tujuan</th>
                                    <th scope="col" class="px-6 py-3">Jenis Pemohon</th>
                                    <th scope="col" class="px-6 py-3 text-center">Status</th>
                                    <th scope="col" class="px-6 py-3 text-center">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="request in filteredRequests" :key="request.id">
                                    <tr class="bg-white border-b hover:bg-gray-50">
                                        <td class="px-6 py-4 font-medium text-gray-900" x-text="request.id"></td>
                                        <td class="px-6 py-4" x-text="request.date"></td>
                                        <td class="px-6 py-4" x-text="request.opd"></td>
                                        <td class="px-6 py-4 capitalize" x-text="request.type"></td>
                                        <td class="px-6 py-4 text-center">
                                            <span class="px-3 py-1 text-xs font-medium rounded-full" :class="statusClass(request.status)" x-text="request.status"></span>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <button @click="viewRequest(request)" class="font-medium text-blue-600 hover:underline">Lihat Detail</button>
                                        </td>
                                    </tr>
                                </template>
                                <template x-if="filteredRequests.length === 0">
                                     <tr><td colspan="6" class="text-center py-10 text-gray-500">Tidak ada data yang cocok dengan pencarian Anda.</td></tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </main>
            </div>
            <!-- Modal for Request Details -->
            <div x-show="isModalOpen" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50" x-cloak>
                <div @click.away="closeModal()" class="bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] flex flex-col">
                    <div class="flex justify-between items-center p-5 border-b">
                        <h3 class="text-xl font-semibold text-gray-900">Detail Permintaan: <span x-text="selectedRequest.id"></span></h3>
                        <button @click="closeModal()" class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                    </div>
                    <div class="p-6 space-y-6 overflow-y-auto" x-if="selectedRequest.id">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                            <div class="space-y-4">
                                <div><p class="font-semibold text-gray-700">Tanggal:</p><p x-text="selectedRequest.date"></p></div>
                                <div><p class="font-semibold text-gray-700">OPD Tujuan:</p><p x-text="selectedRequest.opd"></p></div>
                                <div><p class="font-semibold text-gray-700">Status:</p><span class="px-3 py-1 text-xs font-medium rounded-full" :class="statusClass(selectedRequest.status)" x-text="selectedRequest.status"></span></div>
                            </div>
                            <div class="space-y-4">
                                <div><p class="font-semibold text-gray-700">Jenis Pemohon:</p><p class="capitalize" x-text="selectedRequest.type"></p></div>
                                <div><p class="font-semibold text-gray-700">No. KTP:</p><p x-text="selectedRequest.nik"></p></div>
                                <div><p class="font-semibold text-gray-700">Alamat:</p><p x-text="selectedRequest.address"></p></div>
                            </div>
                        </div>
                        <hr>
                        <div>
                             <p class="font-semibold text-gray-700">Dokumen Terlampir:</p>
                             <div class="flex flex-col space-y-2 mt-1">
                                 <a href="#" class="flex items-center text-blue-600 hover:underline">Scan KTP.jpg</a>
                                 <a href="#" x-show="selectedRequest.supportingDoc" class="flex items-center text-blue-600 hover:underline" x-cloak>
                                     <span x-text="selectedRequest.supportingDoc"></span>
                                 </a>
                             </div>
                        </div>
                         <hr>
                        <div><p class="font-semibold text-gray-700">Informasi Diminta:</p><p class="mt-1 bg-gray-50 p-3 rounded-lg" x-text="selectedRequest.requestText"></p></div>
                        <div><p class="font-semibold text-gray-700">Alasan Permintaan:</p><p class="mt-1 bg-gray-50 p-3 rounded-lg" x-text="selectedRequest.reasonText"></p></div>
                    </div>
                    <div class="flex items-center justify-end p-5 border-t space-x-4 bg-gray-50 rounded-b-lg">
                        <select x-model="selectedRequest.status" class="w-full md:w-auto p-2 border border-gray-300 rounded-md text-sm">
                            <option value="Baru">Baru</option>
                            <option value="Diproses">Diproses</option>
                            <option value="Selesai">Selesai</option>
                            <option value="Ditolak">Ditolak</option>
                        </select>
                        <button @click="updateRequestStatus()" type="button" class="px-5 py-2.5 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700">Simpan Status</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        function appData() {
            const blankRequest = { id: '', date: '', opd: '', type: '', status: '', nik: '', address: '', supportingDoc: null, requestText: '', reasonText: '' };
            return {
                // APP STATE
                currentPage: 'login', userType: null,
                // FORM STATE
                newRequest: { opd: '', type: '', nik: '', address: '', requestText: '', reasonText: ''},
                files: { ktp: null, supportingDoc: null },
                isSubmitting: false, formSuccess: false, lastRequestId: '',
                // DASHBOARD STATE
                isModalOpen: false, searchTerm: '', selectedRequest: { ...blankRequest },
                requests: [
                    { id: 'PPID-2025-001', date: '27/07/2025', opd: 'Dinas Komunikasi Dan Informatika', type: 'perorangan', status: 'Baru', nik: '617101******0001', address: 'Jl. Ahmad Yani No.1, Pontianak', supportingDoc: null, requestText: 'Data statistik pengguna internet di Kalimantan Barat per triwulan selama tahun 2024.', reasonText: 'Untuk keperluan penelitian akademis.' },
                    { id: 'PPID-2025-002', date: '26/07/2025', opd: 'Badan Perencanaan Pembangunan Daerah', type: 'badan-hukum', status: 'Diproses', nik: '617102******0002', address: 'Jl. Gajah Mada No. 20', supportingDoc: 'Akta Pendirian PT.pdf', requestText: 'Salinan dokumen RPJMD Provinsi Kalbar terbaru.', reasonText: 'Sebagai bahan acuan penyusunan rencana strategis.' },
                    { id: 'PPID-2025-003', date: '25/07/2025', opd: 'Dinas Pendidikan Dan Kebudayaan', type: 'kelompok', status: 'Selesai', nik: '617103******0003', address: 'Jl. Imam Bonjol No. 15', supportingDoc: 'Surat Kuasa Kelompok.pdf', requestText: 'Data jumlah sekolah dan siswa jenjang SMA/SMK.', reasonText: 'Untuk kegiatan advokasi pendidikan.' },
                    { id: 'PPID-2025-004', date: '24/07/2025', opd: 'Dinas Kesehatan', type: 'perorangan', status: 'Ditolak', nik: '617104******0004', address: 'Jl. Dr. Sutomo No. 5', supportingDoc: null, requestText: 'Data rekam medis pasien COVID-19.', reasonText: 'Penelitian pribadi (Informasi dikecualikan).' },
                    { id: 'PPID-2025-005', date: '23/07/2025', opd: 'Badan Kepegawaian Daerah', type: 'instansi', status: 'Baru', nik: '617105******0005', address: 'Jl. Urai Bawadi No. 9', supportingDoc: 'Surat Tugas BKD.pdf', requestText: 'Informasi mengenai jumlah formasi CPNS dan P3K 2024.', reasonText: 'Persiapan untuk mengikuti seleksi CASN.' },
                    { id: 'PPID-2025-006', date: '22/07/2025', opd: 'Dinas Sosial', type: 'kelompok', status: 'Selesai', nik: '617106******0006', address: 'Jl. Sutan Syahrir No. 3', supportingDoc: 'Surat Tugas LSM ABC.pdf', requestText: 'Data jumlah penyandang disabilitas di Kubu Raya.', reasonText: 'Untuk evaluasi program kerja LSM.' }
                ],
                // LOGIN & NAVIGATION
                login(type) { this.userType = type; this.currentPage = type === 'admin' ? 'dashboard' : 'form'; },
                logout() { this.userType = null; this.currentPage = 'login'; this.formSuccess = false; this.resetForm(); },
                // FORM METHODS
                submitRequest() {
                    this.isSubmitting = true;
                    setTimeout(() => { // Simulate API call
                        const newId = `PPID-2025-${(this.requests.length + 1).toString().padStart(3, '0')}`;
                        const newEntry = { id: newId, date: new Date().toLocaleDateString('id-ID'), status: 'Baru', ...this.newRequest };
                        this.requests.unshift(newEntry);
                        this.formSuccess = true;
                        this.lastRequestId = newId;
                        this.resetForm();
                        this.isSubmitting = false;
                        window.scrollTo(0, 0);
                    }, 1500);
                },
                resetForm() {
                    this.newRequest = { opd: '', type: '', nik: '', address: '', requestText: '', reasonText: ''};
                    this.files = { ktp: null, supportingDoc: null };
                },
                handleFileDrop(e, inputId) {
                    const file = e.dataTransfer.files[0];
                    if (inputId === 'ktp-upload') this.files.ktp = file;
                    else this.files.supportingDoc = file;
                },
                // COMPUTED PROPERTIES (GETTERS)
                get applicantTypes() {
                    const common = [{ value: 'perorangan', label: 'Perorangan' }];
                    if (this.userType === 'asn') return [...common, { value: 'instansi', label: 'Instansi' }];
                    if (this.userType === 'non-asn') return [...common, { value: 'badan-hukum', label: 'Badan Hukum' }, { value: 'kelompok', label: 'Kelompok' }];
                    return [];
                },
                get supportingDocLabel() {
                    const labels = { 'instansi': 'Scan Surat Tugas / Dokumen Resmi', 'badan-hukum': 'Scan Akta Pendirian', 'kelompok': 'Scan Surat Kuasa' };
                    return labels[this.newRequest.type] || 'Dokumen Pendukung';
                },
                get totalRequests() { return this.requests.length; },
                get newRequestsCount() { return this.requests.filter(r => r.status === 'Baru').length; },
                get processingRequestsCount() { return this.requests.filter(r => r.status === 'Diproses').length; },
                get completedRequestsCount() { return this.requests.filter(r => r.status === 'Selesai').length; },
                get filteredRequests() {
                    if (this.searchTerm === '') return this.requests;
                    const term = this.searchTerm.toLowerCase();
                    return this.requests.filter(req => req.id.toLowerCase().includes(term) || req.opd.toLowerCase().includes(term));
                },
                // DASHBOARD METHODS
                statusClass(status) {
                    const classes = { 'Baru': 'bg-blue-100 text-blue-800', 'Diproses': 'bg-yellow-100 text-yellow-800', 'Selesai': 'bg-green-100 text-green-800', 'Ditolak': 'bg-red-100 text-red-800' };
                    return classes[status] || 'bg-gray-100 text-gray-800';
                },
                viewRequest(request) { this.selectedRequest = { ...request }; this.isModalOpen = true; },
                closeModal() { this.isModalOpen = false; },
                updateRequestStatus() {
                    const index = this.requests.findIndex(req => req.id === this.selectedRequest.id);
                    if (index !== -1) this.requests[index].status = this.selectedRequest.status;
                    this.closeModal();
                }
            };
        }
    </script>
</body>
</html>
